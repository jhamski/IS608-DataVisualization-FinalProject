---
title: "Visual Analytics - Project Data Preparation"
author: "J. Hamski"
date: "May 3, 2016"
output: html_document
---



#### Packages 
```{r}
library(readxl)
library(readr)
library(dplyr)
library(ggplot2)
library(zoo)
```

#### Load Microdata Excel File
```{r}
microdata <- read_excel('FRBNY-SCE-Public-Microdata-Complete.xlsx', sheet = 'Data', na = "NA", skip = 1)
```

#### Cleaning the microdata dataframe
```{r}
colnames(microdata)[189] <- "_HH_INC_CAT2"

microdata <- microdata[!is.na(microdata$date),]
microdata$date <- as.character(microdata$date)

microdata$date <- as.Date(as.yearmon(microdata$date, "%Y%m"), frac = 1) 
```

#### Create new dataframe from what will be used in project
```{r}
project <- data.frame(NULL)
```

```{r}
project <- microdata[1:4]
```

#### Column-spectific changes 

```{r}
better.worse <- c("much worse off",
                 "somewhat worse off",
                 "about the same",
                 "somewhat better off",
                 "much better off")

project$Fin.better.worse.ago.1 <- factor(microdata$Q1, levels = 1:5, labels = better.worse)
project$Fin.better.worse.from.now.2 <- factor(microdata$Q2, levels = 1:5, labels = better.worse)
```




```{r}
harder.easier <- c("much harder",
                 "somewhat harder",
                 "Equally hard/easy",
                 "somewhat easier",
                 "much easier")

project$obtain.credit.ago.28 <- factor(microdata$Q28, levels = 1:5, labels = harder.easier)
project$obtain.credit.from.now.29 <- factor(microdata$Q29, levels = 1:5, labels = harder.easier)
```

#### Demographic Sections
```{r}
gender <- c("female", "male")
no.yes <- c("no", "yes")

project$gender <- factor(microdata$Q33, levels = 1:2, labels = gender)

project$id.Hispanic <- factor(microdata$Q34, levels = 1:2, labels = no.yes)
project$id.White <- factor(microdata$Q35_1, levels = 0:1, labels = no.yes)
project$id.Black <- factor(microdata$Q35_2, levels = 0:1, labels = no.yes)
project$id.AmerIndian <- factor(microdata$Q35_3, levels = 0:1, labels = no.yes)
project$id.Asian <- factor(microdata$Q35_4, levels = 0:1, labels = no.yes)
project$id.NatHawaiian <- factor(microdata$Q35_5, levels = 0:1, labels = no.yes)
project$id.OtherRace <- factor(microdata$Q35_6, levels = 0:1, labels = no.yes)
```

```{r}
education.levels <- c("Less than high school",
                      "High school dipoma/equivalent",
                      "Some college but no degree",
                      "Associates/ JC College degree",
                      "Bachelor's Degree",
                      "Master's Degree",
                      "Doctoral Degree",
                      "Professional Degree",
                      "Other education")

project$education.levels.36 <- factor(microdata$Q36, levels = 1:9, labels = education.levels)
```

```{r}
length <- c("Less than 1 month",
            "Between 1 and 6 months",
            "Between 6 months and 1 year",
            "Between 1 year and 5 years",
            "More than 5 years")

yes.no <- c("yes", "no")

project$current.job.length.37 <- factor(microdata$Q37, levels = 1:5, labels = length)

project$married.or.partner.38 <- factor(microdata$Q38, levels = 0:1, labels = yes.no)
```

```{r}
project$state <- microdata$`_STATE`
project$years.at.residence.41 <- microdata$Q41
project$years.in.state.42 <- microdata$Q42
```

```{r}
own.rent <- c("own", "rent", "other")

project$own.rent.43 <- factor(microdata$Q43, levels = 1:3, labels = own.rent)
project$own.other.homes.44 <- factor(microdata$Q44, levels = 1:2, labels = yes.no)
project$live.alone.45 <- factor(microdata$Q45new_9, levels = 0:1, labels = no.yes)
```

```{r}
incomes <- c( "Less than $10,000",
              "$10,000 to $19,999",
              "$20,000 to $29,999",
              "$30,000 to $39,999",
              "$40,000 to $49,999",
              "$50,000 to $59,999",
              "$60,000 to $74,999",
              "$75,000 to $99,999",
              "$100,000 to $149,999",
              "$150,000 to $199,999",
              "$200,000 or more")

project$total.income.47 <- factor(microdata$Q47, levels = 1:length(incomes), labels = incomes)
```

```{r}
project$numeracy <- as.factor(microdata$`_NUM_CAT`)
```

```{r}
project$year <- format(project$date, format = "%y")
project$month <- format(project$date, format = "%m")
```


```{r}
save(project, file = "ConsumerExpectationsExplorer/project_data.Rda")
```

