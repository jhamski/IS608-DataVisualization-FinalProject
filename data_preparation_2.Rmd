---
title: "Project Data Preparation"
author: "J. Hamski"
date: "May 7, 2016"
output: html_document
---

```{r}
# data tidying
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
# test graphs
library(ggplot2)
```

Goal: a 'long' data frame with three columns:
(1) date (2) demographic (3) observation

```{r}
format.year <- function(question.data){
  question.data$date <- question.data$date %>%
    as.character() %>%
    as.yearmon("%Y%m") %>%
    as.Date(frac = 1) 
  
  return(question.data)
}
```


# All Respondents

## Inflation
```{r}
demo.data.inflation <- read_excel('FRBNY-SCE-Data.xls', sheet = 'Inflation expectations', na = "NA", skip = 3)

demo.data.inflation$Question <- "Inflation Expectations"

demo.data.inflation$date <- demo.data.inflation$date %>%
  as.character() %>%
  as.yearmon("%Y%m") %>%
  as.Date(frac = 1) 
```

```{r}
data.all <- demo.data.inflation %>% gather("survey", "results", 2:9)
```
## Inflation Uncertainty
```{r}
demo.data.inflation.uncertainty <- read_excel('FRBNY-SCE-Data.xls', sheet = 'Inflation uncertainty', na = "NA", skip = 3)

demo.data.inflation.uncertainty$Question <- "Inflation Expectation Uncertainty"


demo.data.inflation.uncertainty$date <- demo.data.inflation.uncertainty$date %>%
  as.character() %>%
  as.yearmon("%Y%m") %>%
  as.Date(frac = 1) 
```

```{r}
data.all <- rbind(data.all, demo.data.inflation.uncertainty %>% gather("survey", "results", 2:3))
```

## Home Prices
```{r}
demo.data.home.prices <- read_excel('FRBNY-SCE-Data.xls', sheet = 'Home price expectations', na = "NA", skip = 3)

demo.data.home.prices$Question <- "Home Price Change Expectation"

demo.data.home.prices <- format.year(demo.data.home.prices)

data.all <- rbind(data.all, demo.data.home.prices %>% gather("survey", "results", 2:6))
```

## Home Price Uncertainty
```{r}
demo.data.home.prices.uncertainty <- read_excel('FRBNY-SCE-Data.xls', sheet = 'Home price uncertainty', na = "NA", skip = 3)

demo.data.home.prices.uncertainty$Question <- "Home Price Change Uncertainty"

demo.data.home.prices.uncertainty <- format.year(demo.data.home.prices.uncertainty)

data.all <- rbind(data.all, demo.data.home.prices.uncertainty %>% gather("survey", "results", 2:2))
```

## Commodity expectations
```{r}
demo.data.commodities <- read_excel('FRBNY-SCE-Data.xls', sheet = 'Commodity expectations', na = "NA", skip = 3)

demo.data.commodities$Question <- "Commodity Price Change Expecations"

demo.data.commodities <- format.year(demo.data.commodities)

data.all <- rbind(data.all, demo.data.commodities %>% gather("survey", "results", 2:7))
```

## Earnings growth
```{r}
demo.data.earnings <- read_excel('FRBNY-SCE-Data.xls', sheet = 'Earnings growth', na = "NA", skip = 3)

demo.data.earnings$Question <- "Earnings Growth Expecations"

demo.data.earnings <- format.year(demo.data.earnings)

data.all <- rbind(data.all, demo.data.earnings %>% gather("survey", "results", 2:5))
```





# Demographic Breakout
```{r}
data.demo.inflation <- read_excel('FRBNY-SCE-Data.xls', sheet = 'Inflation expectations Demo', na = "NA", skip = 3)
# this tab has essentially two tables side by side
data.demo.inflation.1yr <- data.demo.inflation[1:16]
data.demo.inflation.1yr$Question <- "Median One Year Ahead Inflation Rate Expectation"
data.demo.inflation.3yr <- data.demo.inflation[17:32]
data.demo.inflation.3yr$Question <- "Median Three Year Ahead Inflation Rate Expectation"

data.demo.inflation.1yr$date <- data.demo.inflation.1yr$date %>%
  as.character() %>%
  as.yearmon("%Y%m") %>%
  as.Date(frac = 1)

data.demo.inflation.3yr$date <- data.demo.inflation.3yr$date %>%
  as.character() %>%
  as.yearmon("%Y%m") %>%
  as.Date(frac = 1)
```

```{r}
data.demo <- data.demo.inflation.1yr %>% gather("Demographic", "results", 2:16)
data.demo <- rbind(data.demo, data.demo.inflation.3yr %>% gather("Demographic", "results", 2:16))
```



```{r}
save(data.all, file = "ConsumerExpectationsExplorer/data_all.Rda")
save(data.demo, file = "ConsumerExpectationsExplorer/data_demo.Rda")

```

